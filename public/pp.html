<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />

    <title>ppui</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Exo+2:wght@300&display=swap");
      /* The side navigation menu */
      .sidenav {
        height: 100%; /* 100% Full-height */
        width: 0; /* 0 width - change this with JavaScript */
        position: fixed; /* Stay in place */
        z-index: 1; /* Stay on top */
        top: 0; /* Stay at the top */
        left: 0;
        background-color: #111; /* Black*/
        overflow-x: hidden; /* Disable horizontal scroll */
        padding-top: 60px; /* Place content 60px from the top */
        transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
      }

      /* The navigation menu links */
      .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.3s;
      }

      /* When you mouse over the navigation links, change their color */
      .sidenav a:hover {
        color: #f1f1f1;
      }

      /* Position and style the close button (top right corner) */
      .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
      }

      /* Style page content - use this if you want to push the page content to the right when you open the side navigation */
      #main1 {
        transition: margin-left 0.5s;
        padding: 20px;
      }

      /* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
      @media screen and (max-height: 450px) {
        .sidenav {
          padding-top: 15px;
        }
        .sidenav a {
          font-size: 18px;
        }
      }
      header {
        padding: 0px 0px 0px 0px;
        margin: 0px 0px 0px 0px;
      }

      .bgcatimg {
        background-image: url("/StyleSheets/res/mainBG.png");
        height: 700px;
        width: 1920px;
        background-repeat: no-repeat;
        background-size: contain;
        position: absolute;
        bottom: 300px;
      }


      .appBox {
        position: fixed;
        border-radius: 10px;
        width: 300px;
        height: 200px;
        padding: 10px 10px 10px 10px;
        background: grey;
        text-align: center;
        top: 150px;
        left: 625px;
        display: none;
      }

      .appBox > button {
        margin-top: 15px;
      }

      .form-check-input {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .form-check-label {
        margin-top: 15px;
        color: white;
      }

      #clsBtn {
        height: 23px;
        border-radius: 50%;
        background-color: red;
        outline: none;
        border: none;
        margin-bottom: 10px;
        margin-left: 250px;
        margin-top: 5px;
      }

      .card {
        position: absolute;
        top: 700px;
        left: 875px;
      }

      .btn-primary {
        padding: 5px 40px 5px 40px;
        background-color: #db6565;
        outline: none;
        border: 0ch;
        position: absolute;
        bottom: 200px;
        left: 850px;
        margin: 0px 0px 0px 0px;
        width: 250px;
        height: 50px;
      }
      .settings {
        background-image: url("/StyleSheets/res/hamIcon.png");
        background-repeat: no-repeat;
        background-size: contain;
        outline: none;
        border: 0ch;
        height: 75px;
        width: 50px;
        background-color: transparent;
        padding: 0px 0px 0px 0px;
        position: absolute;
        left: 50px;
        top: 150px;
      }

      .notify {
        background-image: url("/StyleSheets/res/bellIcon.png");
        background-repeat: no-repeat;
        background-size: contain;
        outline: none;
        border: 0ch;
        height: 75px;
        width: 50px;
        background-color: transparent;
        padding: 0px 0px 0px 0px;
        position: absolute;
        left: 1650px;
        top: 150px;
      }

      .appointmentStatus {
        background-image: url("/StyleSheets/res/AppointmentIcon.png");
        background-repeat: no-repeat;
        background-size: contain;
        outline: none;
        border: 0ch;
        height: 75px;
        width: 50px;
        background-color: transparent;
        padding: 0px 0px 0px 0px;
        position: absolute;
        left: 1750px;
        top: 150px;
      }

      header ul {
        padding: 10px 10px 10px 400px;
        margin: 10px 10px 10px 100px;
      }

      header li {
        float: left;
        list-style-type: none;
        padding: 10px 10px 10px 75px;
        margin: 10px 10px 10px 10px;
        display: inline;
      }

      nav {
        position: relative;
        top: 100px;
      }

      a {
        color: black;
        font-family: "Exo 2", sans-serif;
        font-size: 18px;
        font-weight: bold;
      }

      /* styles for status block */
      .status-block{
        
        border: 1px;
        width: 500px;
        height: 500px;
        position: absolute;
        bottom: 200px;
        left: 850px;
      }
      .username{
        display: block;
        position: absolute;
        top:300px;
        left:300px;
        
      }
    </style>
  </head>

  <body>
    <!-- settings slide panel inside a div tag-->
    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="#">profile</a>
      <a href="#">edit profile</a>
      <a href="#">...</a>
      <a href="#">...</a>
    </div>
    

    <!-- bg image and nav bar and buttons inside a header tag-->
    <header class="bgcatimg">
      <nav>
        <ul class="mylist">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Vet Visits</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Prescriptions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Case Sheets</a>
          </li>
        </ul>
      </nav>

      <button class="settings" onclick="openNav()"></button>
      <button class="notify"></button>
      <button class="appointmentStatus"></button>

      <div class="username">
        <p>username</p>
      </div>
    </header>


    
    <!-- status block -->
    <!-- <div class="status-block">
      <div class="vetVisitsCount">
        <h1>vet visits</h1>
        <p>0</p>
      </div>

      <div class="prescriptionsCount">
        <h1>vet visits</h1>
        <p>0</p>
      </div>

      <div class="petsCount">
        <h1>vet visits</h1>
        <p>0</p>
      </div>
    </div> -->

    <!-- book appointment button on body -->
    <button
      type="button"
      class="btn btn-primary"
      id="pingBtn"
      onclick="showPopUp()"
    >
      book appointment
    </button>

    

    <!-- book appointment pop up -->
    <div class="appBox" id="popUp1">
      <button
        type="button"
        class="btnClose"
        id="clsBtn"
        onclick="hidePopUp()"
      ></button>

      <div class="form-floating">
        <input
          type="time"
          class="form-control"
          id="floatingTime"
          placeholder="appointment time"
        />
        <label for="floatingPassword">appointment time</label>
      </div>

      <span>
        <input
          class="form-check-input"
          type="radio"
          name="flexRadioDefault"
          id="rdb1"
          checked
        />
        <label class="form-check-label" for="flexRadioDefault2">
          illness
        </label>

        <input
          class="form-check-input"
          type="radio"
          name="flexRadioDefault"
          id="rdb2"
          checked
        />
        <label class="form-check-label" for="flexRadioDefault2">
          vaccination
        </label>
      </span>

      <div class="form-floating">
        <textarea
          class="form-control"
          placeholder="Leave a comment here"
          id="floatingTextarea2"
          style="height: 100px"
        ></textarea>
        <label for="floatingTextarea2">Comments</label>
      </div>

      <button
        type="submit"
        class="submitBtn"
        id="bkAppBtn"
        onclick="bookApp()"
      >
        submit
      </button>
    </div>


    <script>
      const socket = new WebSocket("wss://mighty-shelf-60355.herokuapp.com");

      // Connection opened
      socket.addEventListener("open", function (event) {
        var responseToRegisterClient = `{"reqType":"register", "userEmail":"${getCookie(
          "userPpEmail"
        )}", "userPpType":"${getCookie("userPpType")}"}`;
        socket.send(responseToRegisterClient);
      });

      // Listen for messages
      socket.addEventListener("message", function (event) {
        console.log("Message from server ", event.data);
        var jsonReqForReqType = JSON.parse(event.data);
        var choice = jsonReqForReqType["resType"];
        switch (choice) {
          case "gotAppRes":
            break;
        }
      });

      //***********************************
      function bookApp() {
        console.log("finding the closest doc");

        //optional object to specify any additonal options
        var options = {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0,
        };

        //a success callback function, called inside getCurrentPosition() method by passing the position as an arg
        //this function lets us use the location
        function success(pos) {
          var emailid = getCookie("userPpEmail");
          var time = document.getElementById("floatingTime").value;
          var purpose = "";
          if (document.getElementById("rdb1").checked) {
            purpose = "illness";
          } else {
            purpose = "vaccination";
          }
          var desc = document.getElementById("floatingTextarea2").value;

          var crd = pos.coords;
          var UsersPayload = {
            reqType: "book",
            ppemail: emailid,
            locationLat: crd.latitude,
            locationLong: crd.longitude,
            timeForApp: time,
            purpose: purpose,
            description: desc,
          };

          var JSONUsersPayload = JSON.stringify(UsersPayload);
          socket.send(JSONUsersPayload);

          //json_for_bookreq:{"reqType":"book", "ppemail":"abc@gmail.com", "time":"00:00", "type":"illness", "desc":"anything"}
        }

        //an error callback funtion
        function error(err) {
          alert("please enable the permission for location");
          console.warn(`ERROR(${err.code}): ${err.message}`);
        }

        navigator.geolocation.getCurrentPosition(success, error, options);
      }

      function showPopUp() {
        document.getElementById("popUp1").style.display = "table";
      }
      function hidePopUp() {
        document.getElementById("popUp1").style.display = "none";
      }

      function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
      }

      /* Set the width of the side navigation to 0 */
      function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
      }

      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(";");
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == " ") {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }
    </script>
  </body>
</html>
